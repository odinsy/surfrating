<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Рейтинг серфингистов России</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <el-container>
            <el-header class="header">
                <div class="header-top">
                    <h1>Рейтинг серфингистов</h1>
                    <div class="gender-tabs">
                        <div
                            class="gender-tab"
                            :class="{ active: selectedGender === 'men' }"
                            @click="selectedGender = 'men'"
                        >
                            Мужчины
                        </div>
                        <div
                            class="gender-tab"
                            :class="{ active: selectedGender === 'women' }"
                            @click="selectedGender = 'women'"
                        >
                            Женщины
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <div class="control-group">
                        <label>Дисциплина</label>
                        <el-select v-model="selectedDiscipline" class="wider-select">
                            <el-option
                                v-for="item in disciplines"
                                :key="item.value"
                                :label="item.label"
                                :value="item.value"
                            />
                        </el-select>
                    </div>

                    <div class="control-group">
                        <label>Регион</label>
                        <el-select v-model="selectedRegion">
                            <el-option
                                v-for="item in regions"
                                :key="item.value"
                                :label="item.label"
                                :value="item.value"
                            />
                        </el-select>
                    </div>
                </div>
            </el-header>

            <el-main class="main-content">
                <div class="view-switcher">
                    <div
                        class="view-tab"
                        :class="{ active: activeTab === 'year' }"
                        @click="activeTab = 'year'"
                    >
                        Годовой рейтинг
                    </div>
                    <div
                        class="view-tab"
                        :class="{ active: activeTab === 'overall' }"
                        @click="activeTab = 'overall'"
                    >
                        Общий рейтинг
                    </div>
                </div>

                <div v-if="activeTab === 'year'" class="year-selector">
                    <el-select v-model="selectedYear">
                        <el-option
                            v-for="year in availableYears"
                            :key="year"
                            :label="year"
                            :value="year"
                        />
                    </el-select>
                </div>

                <div class="athlete-count" v-if="currentYearData.length">
                    Всего атлетов: {{ currentYearData.length }}
                </div>

                <el-table
                    :data="activeTab === 'year' ? currentYearData : overallRanking"
                    stripe
                    class="ranking-table"
                    v-loading="loading"
                >
                    <el-table-column prop="rank" label="Место" width="90" fixed="left"/>
                    <el-table-column prop="name" label="Имя" width="220" fixed="left">
                        <template #default="scope">
                            <div class="athlete-name">
                                <div class="athlete-photo"></div>
                                {{ scope.row.name }}
                            </div>
                        </template>
                    </el-table-column>
                    <el-table-column prop="region" label="Регион" v-if="activeTab === 'overall'"/>
                    <el-table-column prop="sport_rank" label="Разряд" width="120" v-if="activeTab === 'overall'"/>

                    <el-table-column
                        :label="activeTab === 'year' ? 'Очки за год' : 'Всего очков'"
                        width="140"
                        align="right"
                    >
                        <template #default="scope">
                            <strong>{{ scope.row[activeTab === 'year' ? 'year_points' : 'total_points'] }}</strong>
                        </template>
                    </el-table-column>

                    <el-table-column v-if="activeTab === 'overall'" label="Лучший результат">
                        <template #default="scope">
                            {{ scope.row.best_result.event }} ({{ scope.row.best_result.place }} место)
                        </template>
                    </el-table-column>

                    <el-table-column v-if="activeTab === 'year'" label="Соревнования" width="160">
                        <template #default="scope">
                            <el-popover
                                placement="left"
                                width="300"
                                trigger="click"
                            >
                                <template #reference>
                                    <el-button class="events-button">
                                        {{ scope.row.events.length }} соревнований
                                    </el-button>
                                </template>
                                <div v-for="(event, idx) in scope.row.events" :key="idx" class="event-item">
                                    <div class="event-name">{{ event.name }}</div>
                                    <div class="event-details">
                                        <span class="event-place">{{ event.place }}-е место</span>
                                        <span class="event-points">{{ event.points }} очков</span>
                                    </div>
                                </div>
                            </el-popover>
                        </template>
                    </el-table-column>
                </el-table>
            </el-main>
        </el-container>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="app.js"></script>
</body>
</html>
