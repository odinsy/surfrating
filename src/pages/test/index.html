<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Рейтинг спортсменов</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/slugify@1.6.6/slugify.js"></script>
</head>
<body>
    <div id="app">
        <el-container>
            <!-- Header -->
            <el-header class="global-header">
                <div class="header-content">
                    <div class="header-brand">
                        <el-dropdown trigger="click">
                            <span class="el-dropdown-link header-title-block">
                                <h1>Рейтинг</h1>
                                <i class="el-icon-arrow-down el-icon--right"></i>
                            </span>
                            <template #dropdown>
                                <el-dropdown-menu>
                                    <el-dropdown-item :class="{ 'active': currentDiscipline === 'shortboard' }" @click="changeDiscipline('shortboard')">Короткая доска</el-dropdown-item>
                                    <el-dropdown-item :class="{ 'active': currentDiscipline === 'longboard' }" @click="changeDiscipline('longboard')">Длинная доска</el-dropdown-item>
                                    <el-dropdown-item :class="{ 'active': currentDiscipline === 'wakesurfing' }" @click="changeDiscipline('wakesurfing')">Вейксерфинг</el-dropdown-item>
                                    <el-dropdown-item :class="{ 'active': currentDiscipline === 'wakeskim' }" @click="changeDiscipline('wakeskim')">Вейкским</el-dropdown-item>
                                </el-dropdown-menu>
                            </template>
                        </el-dropdown>
                    </div>
                    <nav class="header-nav">
                        <a href="#" class="header-nav-link active">Рейтинг</a>
                        <a href="#" class="header-nav-link">События</a>
                        <a href="#" class="header-nav-link">Спортсмены</a>
                    </nav>
                </div>
            </el-header>

            <!-- Main Content -->
            <el-main class="container">
                <div class="controls">
                    <el-select v-model="currentCompetition" placeholder="Выберите соревнование" class="discipline-select">
                        <el-option
                            v-for="comp in competitions[currentDiscipline]"
                            :key="comp.value"
                            :label="comp.label"
                            :value="comp.value">
                        </el-option>
                    </el-select>
                    <el-select v-model="currentYear" placeholder="Выберите год" class="discipline-select">
                        <el-option label="Все годы" value="all"></el-option>
                        <el-option
                            v-for="year in years"
                            :key="year"
                            :label="year"
                            :value="year">
                        </el-option>
                    </el-select>
                    <div class="gender-switch">
                        <el-button :class="{ 'active': currentGender === 'men' }" @click="changeGender('men')">Мужчины</el-button>
                        <el-button :class="{ 'active': currentGender === 'women' }" @click="changeGender('women')">Женщины</el-button>
                    </div>
                </div>

                <el-table
                    :data="tableData"
                    class="ranking-table"
                    :default-sort="{ prop: 'rank', order: 'ascending' }">
                    <el-table-column prop="rank" label="#" width="60" align="center"></el-table-column>
                    <el-table-column prop="name" label="Name" min-width="300">
                        <template #default="{ row }">
                            <div class="avatar-wrapper">
                                <div class="athlete-avatar">
                                    <img :src="row.avatarPath" :alt="row.name" @error="handleImageError($event)">
                                    <div class="avatar-fallback">{{ row.initials }}</div>
                                </div>
                                <div>
                                    <div class="athlete-name">{{ row.name }}</div>
                                    <div class="athlete-region">{{ row.region }}</div>
                                </div>
                            </div>
                            <el-tooltip
                                :content="getTooltipContent(row)"
                                placement="bottom"
                                effect="light"
                                :show-after="200">
                                <div class="tooltip-item">
                                    <div class="tooltip-header">
                                        <div class="tooltip-meta">
                                            <div class="tooltip-name">{{ row.name }}</div>
                                            <div class="tooltip-region">{{ row.region }}</div>
                                        </div>
                                        <img :src="row.avatarPath" class="tooltip-avatar" :alt="row.name" @error="handleImageError($event)">
                                    </div>
                                    <div class="tooltip-stats">
                                        <div class="tooltip-stat">
                                            <div class="tooltip-value">#{{ row.rank }}</div>
                                            <div class="tooltip-label">Ранк</div>
                                        </div>
                                        <div class="tooltip-stat">
                                            <div class="tooltip-value">{{ row.sport_rank || '—' }}</div>
                                            <div class="tooltip-label">Разряд</div>
                                        </div>
                                        <div class="tooltip-stat">
                                            <div class="tooltip-value">{{ row.bestResult }}</div>
                                            <div class="tooltip-label">Лучший результат</div>
                                        </div>
                                    </div>
                                    <div class="tooltip-social">
                                        <a href="https://topheats.ru" target="_blank">topheats.ru</a>
                                    </div>
                                </div>
                            </el-tooltip>
                        </template>
                    </el-table-column>
                    <el-table-column prop="bestResult" label="Best" align="center">
                        <template #default="{ row }">
                            <el-tooltip :content="row.best_result?.event || 'Нет данных'" placement="top" effect="light">
                                <span>{{ row.bestResult }}</span>
                            </el-tooltip>
                        </template>
                    </el-table-column>
                    <el-table-column
                        v-for="year in years"
                        :key="year"
                        :label="year"
                        align="center"
                        min-width="100">
                        <template #default="{ row }">
                            <el-tooltip
                                :content="getYearTooltipContent(row, year)"
                                placement="top"
                                effect="light"
                                :show-after="200"
                                v-if="row.years?.[year]?.events?.length">
                                <span>{{ row.years?.[year]?.year_total_points || '—' }}</span>
                            </el-tooltip>
                            <span v-else>{{ row.years?.[year]?.year_total_points || '—' }}</span>
                        </template>
                    </el-table-column>
                    <el-table-column prop="total_points" label="Total" align="center" width="100"></el-table-column>
                </el-table>
            </el-main>
        </el-container>
    </div>

    <script src="app.js"></script>
</body>
</html>
